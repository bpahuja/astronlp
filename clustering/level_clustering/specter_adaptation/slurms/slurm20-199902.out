2025-08-31 14:40:52,388 - INFO - Checking dependencies...
2025-08-31 14:40:56,732 - INFO - All dependencies available ✓
2025-08-31 14:40:56,735 - INFO - Visualization Configuration:
2025-08-31 14:40:56,735 - INFO -   embeddings_dir: embeddings_v1
2025-08-31 14:40:56,735 - INFO -   cluster_dir: cluster_out_v1
2025-08-31 14:40:56,735 - INFO -   output_dir: ./cluster_analysis_v1
2025-08-31 14:40:56,735 - INFO -   max_samples: 50000
2025-08-31 14:40:56,735 - INFO -   methods: ['pca', 'umap']
2025-08-31 14:40:56,735 - INFO -   use_gpu: True
2025-08-31 14:40:56,735 - INFO -   network_threshold: 0.1
2025-08-31 14:40:56,735 - INFO -   n_wordclouds: 10
2025-08-31 14:40:56,735 - INFO -   skip_3d: False
2025-08-31 14:40:56,735 - INFO -   skip_wordclouds: False
2025-08-31 14:40:56,735 - INFO -   skip_network: False
2025-08-31 14:40:56,736 - INFO - Available memory: 45.7 GB
2025-08-31 14:40:56,736 - INFO - GPU acceleration enabled for visualizations
2025-08-31 14:40:56,736 - INFO - Starting clustering visualization and analysis pipeline...
2025-08-31 14:40:56,736 - INFO - Loading embeddings and clustering results...
2025-08-31 14:40:56,739 - INFO - Loading embeddings from chunk directory: embeddings_v1
2025-08-31 14:40:56,740 - INFO - Found 1,375,099 paragraphs in 138 chunks
GPU acceleration enabled with cuML/RAPIDS
GPU acceleration enabled with cuML/RAPIDS
Loading embedding chunks:   0%|          | 0/138 [00:00<?, ?it/s]Loading embedding chunks:   1%|          | 1/138 [00:00<00:37,  3.70it/s]Loading embedding chunks:   1%|▏         | 2/138 [00:00<00:36,  3.72it/s]Loading embedding chunks:   2%|▏         | 3/138 [00:00<00:34,  3.86it/s]Loading embedding chunks:   3%|▎         | 4/138 [00:01<00:34,  3.93it/s]Loading embedding chunks:   4%|▎         | 5/138 [00:01<00:33,  3.96it/s]Loading embedding chunks:   4%|▍         | 6/138 [00:01<00:32,  4.03it/s]Loading embedding chunks:   5%|▌         | 7/138 [00:01<00:32,  4.05it/s]Loading embedding chunks:   6%|▌         | 8/138 [00:02<00:32,  4.02it/s]Loading embedding chunks:   7%|▋         | 9/138 [00:02<00:32,  4.00it/s]Loading embedding chunks:   7%|▋         | 10/138 [00:02<00:31,  4.04it/s]Loading embedding chunks:   8%|▊         | 11/138 [00:02<00:31,  4.01it/s]Loading embedding chunks:   9%|▊         | 12/138 [00:03<00:31,  3.96it/s]Loading embedding chunks:   9%|▉         | 13/138 [00:03<00:31,  3.92it/s]Loading embedding chunks:  10%|█         | 14/138 [00:03<00:31,  3.92it/s]Loading embedding chunks:  11%|█         | 15/138 [00:03<00:30,  3.98it/s]Loading embedding chunks:  12%|█▏        | 16/138 [00:04<00:30,  3.97it/s]Loading embedding chunks:  12%|█▏        | 17/138 [00:04<00:30,  4.00it/s]Loading embedding chunks:  13%|█▎        | 18/138 [00:04<00:30,  3.99it/s]Loading embedding chunks:  14%|█▍        | 19/138 [00:04<00:29,  4.04it/s]Loading embedding chunks:  14%|█▍        | 20/138 [00:05<00:28,  4.10it/s]Loading embedding chunks:  15%|█▌        | 21/138 [00:05<00:28,  4.10it/s]Loading embedding chunks:  16%|█▌        | 22/138 [00:05<00:28,  4.07it/s]Loading embedding chunks:  17%|█▋        | 23/138 [00:05<00:28,  3.99it/s]Loading embedding chunks:  17%|█▋        | 24/138 [00:06<00:28,  3.99it/s]Loading embedding chunks:  18%|█▊        | 25/138 [00:06<00:28,  4.02it/s]Loading embedding chunks:  19%|█▉        | 26/138 [00:06<00:27,  4.06it/s]Loading embedding chunks:  20%|█▉        | 27/138 [00:06<00:27,  4.10it/s]Loading embedding chunks:  20%|██        | 28/138 [00:07<00:28,  3.81it/s]Loading embedding chunks:  21%|██        | 29/138 [00:07<00:28,  3.88it/s]Loading embedding chunks:  22%|██▏       | 30/138 [00:07<00:27,  3.93it/s]Loading embedding chunks:  22%|██▏       | 31/138 [00:07<00:26,  3.97it/s]Loading embedding chunks:  23%|██▎       | 32/138 [00:08<00:26,  4.01it/s]Loading embedding chunks:  24%|██▍       | 33/138 [00:08<00:26,  4.00it/s]Loading embedding chunks:  25%|██▍       | 34/138 [00:08<00:25,  4.03it/s]Loading embedding chunks:  25%|██▌       | 35/138 [00:08<00:25,  4.07it/s]Loading embedding chunks:  26%|██▌       | 36/138 [00:09<00:25,  4.02it/s]Loading embedding chunks:  27%|██▋       | 37/138 [00:09<00:24,  4.07it/s]Loading embedding chunks:  28%|██▊       | 38/138 [00:09<00:24,  4.10it/s]Loading embedding chunks:  28%|██▊       | 39/138 [00:09<00:23,  4.15it/s]Loading embedding chunks:  29%|██▉       | 40/138 [00:09<00:23,  4.17it/s]Loading embedding chunks:  30%|██▉       | 41/138 [00:10<00:23,  4.15it/s]Loading embedding chunks:  30%|███       | 42/138 [00:10<00:23,  4.10it/s]Loading embedding chunks:  31%|███       | 43/138 [00:10<00:23,  4.09it/s]Loading embedding chunks:  32%|███▏      | 44/138 [00:10<00:22,  4.10it/s]Loading embedding chunks:  33%|███▎      | 45/138 [00:11<00:23,  3.97it/s]Loading embedding chunks:  33%|███▎      | 46/138 [00:11<00:22,  4.05it/s]Loading embedding chunks:  34%|███▍      | 47/138 [00:11<00:22,  4.07it/s]Loading embedding chunks:  35%|███▍      | 48/138 [00:11<00:22,  4.07it/s]Loading embedding chunks:  36%|███▌      | 49/138 [00:12<00:22,  4.00it/s]Loading embedding chunks:  36%|███▌      | 50/138 [00:12<00:21,  4.06it/s]Loading embedding chunks:  37%|███▋      | 51/138 [00:12<00:21,  4.08it/s]Loading embedding chunks:  38%|███▊      | 52/138 [00:12<00:21,  4.01it/s]Loading embedding chunks:  38%|███▊      | 53/138 [00:13<00:21,  4.04it/s]Loading embedding chunks:  39%|███▉      | 54/138 [00:13<00:20,  4.09it/s]Loading embedding chunks:  40%|███▉      | 55/138 [00:13<00:21,  3.94it/s]Loading embedding chunks:  41%|████      | 56/138 [00:13<00:20,  3.98it/s]Loading embedding chunks:  41%|████▏     | 57/138 [00:14<00:20,  3.98it/s]Loading embedding chunks:  42%|████▏     | 58/138 [00:14<00:19,  4.03it/s]Loading embedding chunks:  43%|████▎     | 59/138 [00:14<00:19,  4.10it/s]Loading embedding chunks:  43%|████▎     | 60/138 [00:14<00:18,  4.12it/s]Loading embedding chunks:  44%|████▍     | 61/138 [00:15<00:18,  4.08it/s]Loading embedding chunks:  45%|████▍     | 62/138 [00:15<00:18,  4.08it/s]Loading embedding chunks:  46%|████▌     | 63/138 [00:15<00:18,  4.02it/s]Loading embedding chunks:  46%|████▋     | 64/138 [00:15<00:18,  4.03it/s]Loading embedding chunks:  47%|████▋     | 65/138 [00:16<00:18,  4.00it/s]Loading embedding chunks:  48%|████▊     | 66/138 [00:16<00:17,  4.02it/s]Loading embedding chunks:  49%|████▊     | 67/138 [00:16<00:17,  4.08it/s]Loading embedding chunks:  49%|████▉     | 68/138 [00:16<00:17,  4.04it/s]Loading embedding chunks:  50%|█████     | 69/138 [00:17<00:16,  4.09it/s]Loading embedding chunks:  51%|█████     | 70/138 [00:17<00:16,  4.10it/s]Loading embedding chunks:  51%|█████▏    | 71/138 [00:17<00:16,  4.10it/s]Loading embedding chunks:  52%|█████▏    | 72/138 [00:17<00:16,  4.11it/s]Loading embedding chunks:  53%|█████▎    | 73/138 [00:18<00:16,  4.00it/s]Loading embedding chunks:  54%|█████▎    | 74/138 [00:18<00:16,  3.95it/s]Loading embedding chunks:  54%|█████▍    | 75/138 [00:18<00:15,  4.00it/s]Loading embedding chunks:  55%|█████▌    | 76/138 [00:18<00:15,  3.99it/s]Loading embedding chunks:  56%|█████▌    | 77/138 [00:19<00:15,  3.93it/s]Loading embedding chunks:  57%|█████▋    | 78/138 [00:19<00:15,  3.92it/s]Loading embedding chunks:  57%|█████▋    | 79/138 [00:19<00:15,  3.88it/s]Loading embedding chunks:  58%|█████▊    | 80/138 [00:19<00:14,  3.92it/s]Loading embedding chunks:  59%|█████▊    | 81/138 [00:20<00:14,  3.93it/s]Loading embedding chunks:  59%|█████▉    | 82/138 [00:20<00:14,  3.91it/s]Loading embedding chunks:  60%|██████    | 83/138 [00:20<00:13,  3.96it/s]Loading embedding chunks:  61%|██████    | 84/138 [00:20<00:13,  3.95it/s]Loading embedding chunks:  62%|██████▏   | 85/138 [00:21<00:13,  3.95it/s]Loading embedding chunks:  62%|██████▏   | 86/138 [00:21<00:12,  4.01it/s]Loading embedding chunks:  63%|██████▎   | 87/138 [00:21<00:12,  4.07it/s]Loading embedding chunks:  64%|██████▍   | 88/138 [00:21<00:12,  4.14it/s]Loading embedding chunks:  64%|██████▍   | 89/138 [00:22<00:12,  4.06it/s]Loading embedding chunks:  65%|██████▌   | 90/138 [00:22<00:11,  4.05it/s]Loading embedding chunks:  66%|██████▌   | 91/138 [00:22<00:11,  4.05it/s]Loading embedding chunks:  67%|██████▋   | 92/138 [00:22<00:11,  4.06it/s]Loading embedding chunks:  67%|██████▋   | 93/138 [00:23<00:11,  4.07it/s]Loading embedding chunks:  68%|██████▊   | 94/138 [00:23<00:10,  4.08it/s]Loading embedding chunks:  69%|██████▉   | 95/138 [00:23<00:10,  4.09it/s]Loading embedding chunks:  70%|██████▉   | 96/138 [00:23<00:10,  4.12it/s]Loading embedding chunks:  70%|███████   | 97/138 [00:24<00:10,  4.08it/s]Loading embedding chunks:  71%|███████   | 98/138 [00:24<00:09,  4.03it/s]Loading embedding chunks:  72%|███████▏  | 99/138 [00:24<00:09,  4.06it/s]Loading embedding chunks:  72%|███████▏  | 100/138 [00:24<00:09,  4.06it/s]Loading embedding chunks:  73%|███████▎  | 101/138 [00:25<00:09,  4.03it/s]Loading embedding chunks:  74%|███████▍  | 102/138 [00:25<00:08,  4.03it/s]Loading embedding chunks:  75%|███████▍  | 103/138 [00:25<00:08,  4.10it/s]Loading embedding chunks:  75%|███████▌  | 104/138 [00:25<00:08,  4.04it/s]Loading embedding chunks:  76%|███████▌  | 105/138 [00:26<00:08,  4.07it/s]Loading embedding chunks:  77%|███████▋  | 106/138 [00:26<00:07,  4.08it/s]Loading embedding chunks:  78%|███████▊  | 107/138 [00:26<00:07,  4.14it/s]Loading embedding chunks:  78%|███████▊  | 108/138 [00:26<00:07,  4.12it/s]Loading embedding chunks:  79%|███████▉  | 109/138 [00:27<00:07,  4.09it/s]Loading embedding chunks:  80%|███████▉  | 110/138 [00:27<00:06,  4.08it/s]Loading embedding chunks:  80%|████████  | 111/138 [00:27<00:06,  4.08it/s]Loading embedding chunks:  81%|████████  | 112/138 [00:27<00:06,  4.09it/s]Loading embedding chunks:  82%|████████▏ | 113/138 [00:28<00:06,  4.04it/s]Loading embedding chunks:  83%|████████▎ | 114/138 [00:28<00:05,  4.02it/s]Loading embedding chunks:  83%|████████▎ | 115/138 [00:28<00:05,  4.07it/s]Loading embedding chunks:  84%|████████▍ | 116/138 [00:28<00:05,  4.08it/s]Loading embedding chunks:  85%|████████▍ | 117/138 [00:29<00:05,  4.03it/s]Loading embedding chunks:  86%|████████▌ | 118/138 [00:29<00:05,  3.97it/s]Loading embedding chunks:  86%|████████▌ | 119/138 [00:29<00:04,  3.98it/s]Loading embedding chunks:  87%|████████▋ | 120/138 [00:29<00:04,  4.01it/s]Loading embedding chunks:  88%|████████▊ | 121/138 [00:30<00:04,  4.02it/s]Loading embedding chunks:  88%|████████▊ | 122/138 [00:30<00:04,  3.91it/s]Loading embedding chunks:  89%|████████▉ | 123/138 [00:30<00:03,  3.97it/s]Loading embedding chunks:  90%|████████▉ | 124/138 [00:30<00:03,  4.04it/s]Loading embedding chunks:  91%|█████████ | 125/138 [00:31<00:03,  4.01it/s]Loading embedding chunks:  91%|█████████▏| 126/138 [00:31<00:02,  4.02it/s]Loading embedding chunks:  92%|█████████▏| 127/138 [00:31<00:02,  4.08it/s]Loading embedding chunks:  93%|█████████▎| 128/138 [00:31<00:02,  4.03it/s]Loading embedding chunks:  93%|█████████▎| 129/138 [00:32<00:02,  3.96it/s]Loading embedding chunks:  94%|█████████▍| 130/138 [00:32<00:02,  3.99it/s]Loading embedding chunks:  95%|█████████▍| 131/138 [00:32<00:01,  4.00it/s]Loading embedding chunks:  96%|█████████▌| 132/138 [00:32<00:01,  4.06it/s]Loading embedding chunks:  96%|█████████▋| 133/138 [00:33<00:01,  3.86it/s]Loading embedding chunks:  97%|█████████▋| 134/138 [00:33<00:01,  3.83it/s]Loading embedding chunks:  98%|█████████▊| 135/138 [00:33<00:00,  3.80it/s]Loading embedding chunks:  99%|█████████▊| 136/138 [00:33<00:00,  3.85it/s]Loading embedding chunks:  99%|█████████▉| 137/138 [00:34<00:00,  3.85it/s]Loading embedding chunks: 100%|██████████| 138/138 [00:34<00:00,  4.00it/s]Loading embedding chunks: 100%|██████████| 138/138 [00:34<00:00,  4.02it/s]
2025-08-31 14:41:31,558 - INFO - Successfully loaded 1,375,099 embeddings with dimension 768
2025-08-31 14:41:31,558 - INFO - Sampling 50,000 from 1,375,099 total embeddings
2025-08-31 14:41:31,964 - INFO - Loading cluster labels from result files...
2025-08-31 14:41:31,965 - INFO - Loading 14 clustering result files...
Loading cluster files:   0%|          | 0/14 [00:00<?, ?it/s]Loading cluster files:   7%|▋         | 1/14 [00:02<00:34,  2.63s/it]Loading cluster files:  14%|█▍        | 2/14 [00:04<00:25,  2.09s/it]Loading cluster files:  21%|██▏       | 3/14 [00:06<00:21,  1.92s/it]Loading cluster files:  29%|██▊       | 4/14 [00:09<00:24,  2.48s/it]Loading cluster files:  36%|███▌      | 5/14 [00:12<00:24,  2.73s/it]Loading cluster files:  43%|████▎     | 6/14 [00:15<00:23,  2.94s/it]Loading cluster files:  50%|█████     | 7/14 [00:18<00:18,  2.70s/it]Loading cluster files:  57%|█████▋    | 8/14 [00:19<00:12,  2.14s/it]Loading cluster files:  64%|██████▍   | 9/14 [00:21<00:11,  2.28s/it]Loading cluster files:  71%|███████▏  | 10/14 [00:24<00:10,  2.57s/it]Loading cluster files:  79%|███████▊  | 11/14 [00:28<00:08,  2.91s/it]Loading cluster files:  86%|████████▌ | 12/14 [00:30<00:05,  2.55s/it]Loading cluster files:  93%|█████████▎| 13/14 [00:31<00:02,  2.17s/it]Loading cluster files: 100%|██████████| 14/14 [00:33<00:00,  1.94s/it]Loading cluster files: 100%|██████████| 14/14 [00:33<00:00,  2.36s/it]
2025-08-31 14:42:05,073 - INFO - Loaded 1,375,099 total clustering results
2025-08-31 14:42:05,074 - INFO - Matching sample with clustering results...
2025-08-31 14:42:05,074 - INFO - Using columns for matching: ['paper_id', 'text']
2025-08-31 14:42:12,647 - INFO - Successfully matched 47,086/50,000 samples (94.2%)
2025-08-31 14:42:13,183 - INFO - Loaded 50,000 samples for visualization
2025-08-31 14:42:13,189 - INFO - Clusters: 469
2025-08-31 14:42:13,189 - INFO - Calculating clustering quality metrics...
2025-08-31 14:42:17,078 - INFO - Calculated 24 clustering metrics
2025-08-31 14:42:17,078 - INFO - Creating 2D visualization with PCA...
2025-08-31 14:42:17,078 - INFO - Creating 2D embeddings using PCA...
2025-08-31 14:42:17,635 - WARNING - GPU PCA failed: __init__() got an unexpected keyword argument 'random_state', using CPU
2025-08-31 14:42:17,635 - ERROR - Error creating 2D visualization with pca: name 'PCA' is not defined
2025-08-31 14:42:17,648 - INFO - Creating 2D visualization with UMAP...
2025-08-31 14:42:17,648 - INFO - Creating 2D embeddings using UMAP...
2025-08-31 14:42:34,370 - INFO - Creating 2D matplotlib visualization...
2025-08-31 14:42:34,555 - INFO - findfont: Found a missing font file.  Rebuilding cache.
2025-08-31 14:42:39,556 - WARNING - Matplotlib is building the font cache; this may take a moment.
2025-08-31 14:42:39,632 - INFO - generated new fontManager
2025-08-31 14:42:46,069 - INFO - Saved 2D matplotlib plot to cluster_analysis_v1/cluster_2d_umap.png
2025-08-31 14:42:46,069 - INFO - Creating 3D embeddings using UMAP...
2025-08-31 14:42:50,074 - INFO - Creating 3D Plotly visualization...
2025-08-31 14:42:51,266 - ERROR - Error creating 3D visualization: 'PosixPath' object has no attribute 'endswith'
2025-08-31 14:42:51,268 - INFO - Creating metrics dashboard...
2025-08-31 14:42:53,046 - INFO - Saved metrics dashboard to cluster_analysis_v1/metrics_dashboard.png
2025-08-31 14:42:53,047 - INFO - Creating interactive Plotly dashboard...
2025-08-31 14:42:54,402 - ERROR - Error creating interactive dashboard: 'PosixPath' object has no attribute 'endswith'
2025-08-31 14:42:54,402 - INFO - Generating word clouds for top 10 clusters...
2025-08-31 14:43:04,214 - INFO - Generated word clouds in cluster_analysis_v1/wordclouds
2025-08-31 14:43:04,215 - INFO - Creating cluster network graph...
2025-08-31 14:43:58,490 - INFO - Saved cluster network graph to cluster_analysis_v1/cluster_network.png
2025-08-31 14:43:58,493 - INFO - Saving detailed metrics...
2025-08-31 14:43:58,493 - INFO - Analyzing cluster characteristics...
2025-08-31 14:43:59,063 - ERROR - Visualization pipeline failed: Object of type float32 is not JSON serializable
2025-08-31 14:43:59,064 - ERROR - Visualization pipeline failed: Object of type float32 is not JSON serializable
[2025-08-31 14:42:17.769] [CUML] [info] build_algo set to brute_force_knn because random_state is given
[2025-08-31 14:42:46.100] [CUML] [info] build_algo set to brute_force_knn because random_state is given
Traceback (most recent call last):
  File "/vol/bitbucket/bp824/astro/level_clustering/specter_adaptation/visualize.py", line 1669, in <module>
    main()
  File "/vol/bitbucket/bp824/astro/level_clustering/specter_adaptation/visualize.py", line 1580, in main
    results = visualizer.run_visualization_pipeline()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/vol/bitbucket/bp824/astro/level_clustering/specter_adaptation/visualize.py", line 1438, in run_visualization_pipeline
    self.save_detailed_metrics(metrics_path)
  File "/vol/bitbucket/bp824/astro/level_clustering/specter_adaptation/visualize.py", line 1332, in save_detailed_metrics
    json.dump(detailed_metrics, f, ensure_ascii=False, indent=2)
  File "/usr/lib/python3.12/json/__init__.py", line 179, in dump
    for chunk in iterable:
  File "/usr/lib/python3.12/json/encoder.py", line 432, in _iterencode
    yield from _iterencode_dict(o, _current_indent_level)
  File "/usr/lib/python3.12/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/lib/python3.12/json/encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "/usr/lib/python3.12/json/encoder.py", line 439, in _iterencode
    o = _default(o)
        ^^^^^^^^^^^
  File "/usr/lib/python3.12/json/encoder.py", line 180, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
TypeError: Object of type float32 is not JSON serializable
