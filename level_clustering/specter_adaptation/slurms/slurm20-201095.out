/vol/bitbucket/bp824/astro/astroenv/lib/python3.12/site-packages/umap/__init__.py:36: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
  import pkg_resources
[Script start] CPU: 0.61GB | GPU: 0.00GB used / 0.00GB total
[GPU] GPU Available: True
[GPU] CUML Available: True
[GPU] Device 0: NVIDIA A30 (23.6GB)
[scan] Using 138 shard folders
[Before loading data] CPU: 0.61GB | GPU: 0.00GB used / 0.00GB total
Counting rows:   0%|          | 0/138 [00:00<?, ?chunk/s]Counting rows:   1%|          | 1/138 [00:00<00:16,  8.56chunk/s]Counting rows:   1%|▏         | 2/138 [00:00<00:17,  7.75chunk/s]Counting rows:   3%|▎         | 4/138 [00:00<00:11, 11.80chunk/s]Counting rows:   5%|▌         | 7/138 [00:00<00:09, 13.94chunk/s]Counting rows:   7%|▋         | 10/138 [00:00<00:08, 14.23chunk/s]Counting rows:   9%|▊         | 12/138 [00:06<02:00,  1.05chunk/s]Counting rows:   9%|▉         | 13/138 [00:07<01:48,  1.15chunk/s]Counting rows:  10%|█         | 14/138 [00:07<01:32,  1.34chunk/s]Counting rows:  11%|█         | 15/138 [00:10<02:25,  1.18s/chunk]Counting rows:  12%|█▏        | 16/138 [00:10<01:53,  1.07chunk/s]Counting rows:  12%|█▏        | 17/138 [00:10<01:33,  1.30chunk/s]Counting rows:  14%|█▍        | 19/138 [00:11<01:04,  1.83chunk/s]Counting rows:  15%|█▌        | 21/138 [00:11<00:45,  2.57chunk/s]Counting rows:  16%|█▌        | 22/138 [00:11<00:43,  2.65chunk/s]Counting rows:  17%|█▋        | 23/138 [00:14<01:52,  1.02chunk/s]Counting rows:  17%|█▋        | 24/138 [00:15<01:58,  1.04s/chunk]Counting rows:  18%|█▊        | 25/138 [00:16<01:52,  1.00chunk/s]Counting rows:  19%|█▉        | 26/138 [00:17<01:35,  1.17chunk/s]Counting rows:  20%|█▉        | 27/138 [00:17<01:19,  1.39chunk/s]Counting rows:  21%|██        | 29/138 [00:17<00:46,  2.34chunk/s]Counting rows:  22%|██▏       | 30/138 [00:18<00:42,  2.54chunk/s]Counting rows:  22%|██▏       | 31/138 [00:19<01:19,  1.35chunk/s]Counting rows:  23%|██▎       | 32/138 [00:20<01:20,  1.32chunk/s]Counting rows:  24%|██▍       | 33/138 [00:20<01:02,  1.67chunk/s]Counting rows:  25%|██▍       | 34/138 [00:21<00:51,  2.01chunk/s]Counting rows:  27%|██▋       | 37/138 [00:21<00:27,  3.72chunk/s]Counting rows:  28%|██▊       | 39/138 [00:21<00:21,  4.53chunk/s]Counting rows:  30%|██▉       | 41/138 [00:21<00:16,  6.01chunk/s]Counting rows:  31%|███       | 43/138 [00:21<00:13,  6.93chunk/s]Counting rows:  33%|███▎      | 45/138 [00:22<00:16,  5.57chunk/s]Counting rows:  33%|███▎      | 46/138 [00:22<00:16,  5.67chunk/s]Counting rows:  34%|███▍      | 47/138 [00:22<00:19,  4.79chunk/s]Counting rows:  36%|███▌      | 49/138 [00:22<00:13,  6.58chunk/s]Counting rows:  36%|███▌      | 50/138 [00:23<00:14,  6.06chunk/s]Counting rows:  37%|███▋      | 51/138 [00:23<00:16,  5.34chunk/s]Counting rows:  38%|███▊      | 52/138 [00:23<00:17,  5.06chunk/s]Counting rows:  38%|███▊      | 53/138 [00:23<00:18,  4.51chunk/s]Counting rows:  39%|███▉      | 54/138 [00:24<00:20,  4.17chunk/s]Counting rows:  41%|████      | 56/138 [00:24<00:15,  5.23chunk/s]Counting rows:  43%|████▎     | 59/138 [00:24<00:11,  6.85chunk/s]Counting rows:  43%|████▎     | 60/138 [00:25<00:13,  5.59chunk/s]Counting rows:  45%|████▍     | 62/138 [00:25<00:10,  7.35chunk/s]Counting rows:  46%|████▋     | 64/138 [00:25<00:09,  8.02chunk/s]Counting rows:  47%|████▋     | 65/138 [00:25<00:11,  6.45chunk/s]Counting rows:  48%|████▊     | 66/138 [00:25<00:11,  6.20chunk/s]Counting rows:  49%|████▉     | 68/138 [00:26<00:09,  7.36chunk/s]Counting rows:  51%|█████▏    | 71/138 [00:26<00:07,  8.48chunk/s]Counting rows:  53%|█████▎    | 73/138 [00:26<00:06,  9.48chunk/s]Counting rows:  54%|█████▍    | 75/138 [00:26<00:07,  8.88chunk/s]Counting rows:  55%|█████▌    | 76/138 [00:26<00:07,  8.37chunk/s]Counting rows:  56%|█████▌    | 77/138 [00:27<00:07,  7.89chunk/s]Counting rows:  57%|█████▋    | 78/138 [00:27<00:07,  8.16chunk/s]Counting rows:  58%|█████▊    | 80/138 [00:27<00:05,  9.79chunk/s]Counting rows:  59%|█████▉    | 82/138 [00:27<00:06,  8.68chunk/s]Counting rows:  61%|██████    | 84/138 [00:27<00:05,  9.09chunk/s]Counting rows:  62%|██████▏   | 85/138 [00:27<00:06,  8.48chunk/s]Counting rows:  62%|██████▏   | 86/138 [00:28<00:06,  8.02chunk/s]Counting rows:  64%|██████▍   | 88/138 [00:28<00:05,  9.01chunk/s]Counting rows:  64%|██████▍   | 89/138 [00:28<00:05,  8.45chunk/s]Counting rows:  67%|██████▋   | 92/138 [00:28<00:04, 11.10chunk/s]Counting rows:  68%|██████▊   | 94/138 [00:28<00:04,  9.12chunk/s]Counting rows:  71%|███████   | 98/138 [00:29<00:02, 14.23chunk/s]Counting rows:  72%|███████▏  | 100/138 [00:29<00:02, 13.44chunk/s]Counting rows:  74%|███████▍  | 102/138 [00:29<00:02, 13.11chunk/s]Counting rows:  75%|███████▌  | 104/138 [00:29<00:03,  9.79chunk/s]Counting rows:  77%|███████▋  | 106/138 [00:30<00:04,  7.84chunk/s]Counting rows:  78%|███████▊  | 108/138 [00:30<00:03,  9.40chunk/s]Counting rows:  80%|████████  | 111/138 [00:30<00:02, 10.66chunk/s]Counting rows:  82%|████████▏ | 113/138 [00:30<00:03,  7.85chunk/s]Counting rows:  83%|████████▎ | 115/138 [00:31<00:02,  8.79chunk/s]Counting rows:  85%|████████▍ | 117/138 [00:31<00:02, 10.00chunk/s]Counting rows:  86%|████████▌ | 119/138 [00:31<00:02,  8.48chunk/s]Counting rows:  88%|████████▊ | 122/138 [00:31<00:02,  7.49chunk/s]Counting rows:  90%|████████▉ | 124/138 [00:32<00:01,  7.96chunk/s]Counting rows:  91%|█████████ | 125/138 [00:32<00:02,  5.27chunk/s]Counting rows:  91%|█████████▏| 126/138 [00:32<00:02,  4.86chunk/s]Counting rows:  92%|█████████▏| 127/138 [00:33<00:02,  4.92chunk/s]Counting rows:  93%|█████████▎| 128/138 [00:33<00:02,  4.75chunk/s]Counting rows:  93%|█████████▎| 129/138 [00:33<00:02,  3.91chunk/s]Counting rows:  94%|█████████▍| 130/138 [00:34<00:01,  4.10chunk/s]Counting rows:  95%|█████████▍| 131/138 [00:34<00:02,  3.10chunk/s]Counting rows:  97%|█████████▋| 134/138 [00:34<00:00,  5.30chunk/s]Counting rows:  98%|█████████▊| 135/138 [00:35<00:00,  4.93chunk/s]Counting rows:  99%|█████████▊| 136/138 [00:35<00:00,  4.53chunk/s]Counting rows: 100%|██████████| 138/138 [00:35<00:00,  3.90chunk/s]
[load] Total paragraphs (after sampling): 1,375,099, dim=768
[load] Estimated memory for embeddings: 3.93GB
Loading shards:   0%|          | 0/138 [00:00<?, ?chunk/s]Loading shards:   1%|          | 1/138 [00:00<00:57,  2.37chunk/s]Loading shards:   1%|▏         | 2/138 [00:00<00:47,  2.86chunk/s]Loading shards:   2%|▏         | 3/138 [00:01<00:47,  2.87chunk/s]Loading shards:   3%|▎         | 4/138 [00:01<00:48,  2.75chunk/s]Loading shards:   4%|▎         | 5/138 [00:01<00:44,  3.01chunk/s]Loading shards:   4%|▍         | 6/138 [00:02<00:46,  2.82chunk/s]Loading shards:   5%|▌         | 7/138 [00:04<01:53,  1.16chunk/s]Loading shards:   6%|▌         | 8/138 [00:05<02:32,  1.17s/chunk]Loading shards:   7%|▋         | 9/138 [00:06<02:11,  1.02s/chunk]Loading shards:   7%|▋         | 10/138 [00:07<01:58,  1.08chunk/s]Loading shards:   8%|▊         | 11/138 [00:08<01:55,  1.10chunk/s]Loading shards:   9%|▊         | 12/138 [00:15<06:03,  2.88s/chunk]Loading shards:   9%|▉         | 13/138 [00:30<13:33,  6.51s/chunk]Loading shards:  10%|█         | 14/138 [00:31<10:03,  4.87s/chunk]Loading shards:  11%|█         | 15/138 [00:32<07:39,  3.74s/chunk]Loading shards:  12%|█▏        | 16/138 [00:33<05:51,  2.88s/chunk]Loading shards:  12%|█▏        | 17/138 [00:34<04:42,  2.33s/chunk]Loading shards:  13%|█▎        | 18/138 [00:35<03:55,  1.96s/chunk]Loading shards:  14%|█▍        | 19/138 [00:36<03:14,  1.64s/chunk]Loading shards:  14%|█▍        | 20/138 [00:37<02:45,  1.40s/chunk]Loading shards:  15%|█▌        | 21/138 [00:38<02:23,  1.23s/chunk]Loading shards:  16%|█▌        | 22/138 [00:39<02:08,  1.11s/chunk]Loading shards:  17%|█▋        | 23/138 [00:39<01:51,  1.03chunk/s]Loading shards:  17%|█▋        | 24/138 [00:40<01:39,  1.14chunk/s]Loading shards:  18%|█▊        | 25/138 [00:41<01:33,  1.21chunk/s]Loading shards:  19%|█▉        | 26/138 [00:41<01:28,  1.27chunk/s]Loading shards:  20%|█▉        | 27/138 [00:42<01:28,  1.26chunk/s]Loading shards:  20%|██        | 28/138 [00:47<03:50,  2.10s/chunk]Loading shards:  21%|██        | 29/138 [00:57<07:58,  4.39s/chunk]Loading shards:  22%|██▏       | 30/138 [00:58<06:17,  3.49s/chunk]Loading shards:  22%|██▏       | 31/138 [00:59<04:56,  2.77s/chunk]Loading shards:  23%|██▎       | 32/138 [01:00<03:53,  2.20s/chunk]Loading shards:  24%|██▍       | 33/138 [01:02<03:21,  1.92s/chunk]Loading shards:  25%|██▍       | 34/138 [01:03<02:58,  1.72s/chunk]Loading shards:  25%|██▌       | 35/138 [01:04<02:35,  1.51s/chunk]Loading shards:  26%|██▌       | 36/138 [01:05<02:12,  1.30s/chunk]Loading shards:  27%|██▋       | 37/138 [01:06<02:01,  1.20s/chunk]Loading shards:  28%|██▊       | 38/138 [01:09<03:16,  1.96s/chunk]Loading shards:  28%|██▊       | 39/138 [01:13<03:53,  2.36s/chunk]Loading shards:  29%|██▉       | 40/138 [01:20<06:19,  3.87s/chunk]Loading shards:  30%|██▉       | 41/138 [01:22<05:30,  3.40s/chunk]Loading shards:  30%|███       | 42/138 [01:24<04:33,  2.85s/chunk]Loading shards:  31%|███       | 43/138 [01:30<05:57,  3.77s/chunk]Loading shards:  32%|███▏      | 44/138 [01:32<04:59,  3.18s/chunk]Loading shards:  33%|███▎      | 45/138 [01:35<04:48,  3.11s/chunk]Loading shards:  33%|███▎      | 46/138 [01:38<04:47,  3.12s/chunk]Loading shards:  34%|███▍      | 47/138 [01:40<04:15,  2.81s/chunk]Loading shards:  35%|███▍      | 48/138 [01:43<04:18,  2.87s/chunk]Loading shards:  36%|███▌      | 49/138 [01:46<04:13,  2.84s/chunk]Loading shards:  36%|███▌      | 50/138 [01:51<05:14,  3.57s/chunk]Loading shards:  37%|███▋      | 51/138 [01:53<04:29,  3.10s/chunk]Loading shards:  38%|███▊      | 52/138 [01:54<03:44,  2.61s/chunk]Loading shards:  38%|███▊      | 53/138 [01:57<03:32,  2.50s/chunk]Loading shards:  39%|███▉      | 54/138 [02:01<04:08,  2.96s/chunk]Loading shards:  40%|███▉      | 55/138 [02:06<05:00,  3.62s/chunk]Loading shards:  41%|████      | 56/138 [02:08<04:21,  3.19s/chunk]Loading shards:  41%|████▏     | 57/138 [02:12<04:42,  3.49s/chunk]Loading shards:  42%|████▏     | 58/138 [02:14<04:01,  3.01s/chunk]Loading shards:  43%|████▎     | 59/138 [02:17<04:08,  3.14s/chunk]Loading shards:  43%|████▎     | 60/138 [02:22<04:32,  3.50s/chunk]Loading shards:  44%|████▍     | 61/138 [02:25<04:12,  3.29s/chunk]Loading shards:  45%|████▍     | 62/138 [02:34<06:32,  5.16s/chunk]Loading shards:  46%|████▌     | 63/138 [02:37<05:26,  4.35s/chunk]Loading shards:  46%|████▋     | 64/138 [02:38<04:21,  3.53s/chunk]Loading shards:  47%|████▋     | 65/138 [02:40<03:38,  2.99s/chunk]Loading shards:  48%|████▊     | 66/138 [02:41<03:02,  2.53s/chunk]Loading shards:  49%|████▊     | 67/138 [02:43<02:32,  2.15s/chunk]Loading shards:  49%|████▉     | 68/138 [02:44<02:05,  1.80s/chunk]Loading shards:  50%|█████     | 69/138 [02:44<01:44,  1.51s/chunk]Loading shards:  51%|█████     | 70/138 [02:46<01:41,  1.50s/chunk]Loading shards:  51%|█████▏    | 71/138 [02:47<01:30,  1.35s/chunk]Loading shards:  52%|█████▏    | 72/138 [02:48<01:27,  1.32s/chunk]Loading shards:  53%|█████▎    | 73/138 [02:49<01:20,  1.23s/chunk]Loading shards:  54%|█████▎    | 74/138 [02:50<01:09,  1.09s/chunk]Loading shards:  54%|█████▍    | 75/138 [02:51<01:03,  1.01s/chunk]Loading shards:  55%|█████▌    | 76/138 [02:51<00:55,  1.12chunk/s]Loading shards:  56%|█████▌    | 77/138 [02:58<02:42,  2.67s/chunk]Loading shards:  57%|█████▋    | 78/138 [03:02<02:58,  2.97s/chunk]Loading shards:  57%|█████▋    | 79/138 [03:12<04:53,  4.97s/chunk]Loading shards:  58%|█████▊    | 80/138 [03:13<03:39,  3.79s/chunk]Loading shards:  59%|█████▊    | 81/138 [03:14<02:48,  2.95s/chunk]Loading shards:  59%|█████▉    | 82/138 [03:15<02:15,  2.41s/chunk]Loading shards:  60%|██████    | 83/138 [03:16<01:49,  1.99s/chunk]Loading shards:  61%|██████    | 84/138 [03:17<01:29,  1.65s/chunk]Loading shards:  62%|██████▏   | 85/138 [03:17<01:13,  1.39s/chunk]Loading shards:  62%|██████▏   | 86/138 [03:18<01:04,  1.25s/chunk]Loading shards:  63%|██████▎   | 87/138 [03:19<00:59,  1.17s/chunk]Loading shards:  64%|██████▍   | 88/138 [03:20<00:53,  1.08s/chunk]Loading shards:  64%|██████▍   | 89/138 [03:21<00:48,  1.00chunk/s]Loading shards:  65%|██████▌   | 90/138 [03:22<00:51,  1.07s/chunk]Loading shards:  66%|██████▌   | 91/138 [03:23<00:46,  1.00chunk/s]Loading shards:  67%|██████▋   | 92/138 [03:24<00:46,  1.02s/chunk]Loading shards:  67%|██████▋   | 93/138 [03:25<00:45,  1.02s/chunk]Loading shards:  68%|██████▊   | 94/138 [03:26<00:48,  1.09s/chunk]Loading shards:  69%|██████▉   | 95/138 [03:27<00:45,  1.06s/chunk]Loading shards:  70%|██████▉   | 96/138 [03:29<00:47,  1.12s/chunk]Loading shards:  70%|███████   | 97/138 [03:30<00:50,  1.23s/chunk]Loading shards:  71%|███████   | 98/138 [03:31<00:42,  1.05s/chunk]Loading shards:  72%|███████▏  | 99/138 [03:31<00:36,  1.08chunk/s]Loading shards:  72%|███████▏  | 100/138 [03:32<00:32,  1.15chunk/s]Loading shards:  73%|███████▎  | 101/138 [03:33<00:33,  1.11chunk/s]Loading shards:  74%|███████▍  | 102/138 [03:34<00:36,  1.01s/chunk]Loading shards:  75%|███████▍  | 103/138 [03:35<00:33,  1.05chunk/s]Loading shards:  75%|███████▌  | 104/138 [03:36<00:31,  1.08chunk/s]Loading shards:  76%|███████▌  | 105/138 [03:37<00:31,  1.06chunk/s]Loading shards:  77%|███████▋  | 106/138 [03:38<00:29,  1.10chunk/s]Loading shards:  78%|███████▊  | 107/138 [03:39<00:28,  1.09chunk/s]Loading shards:  78%|███████▊  | 108/138 [03:39<00:25,  1.19chunk/s]Loading shards:  79%|███████▉  | 109/138 [03:40<00:26,  1.10chunk/s]Loading shards:  80%|███████▉  | 110/138 [03:41<00:22,  1.22chunk/s]Loading shards:  80%|████████  | 111/138 [03:42<00:22,  1.20chunk/s]Loading shards:  81%|████████  | 112/138 [03:43<00:21,  1.22chunk/s]Loading shards:  82%|████████▏ | 113/138 [03:44<00:20,  1.21chunk/s]Loading shards:  83%|████████▎ | 114/138 [03:44<00:19,  1.22chunk/s]Loading shards:  83%|████████▎ | 115/138 [03:45<00:19,  1.15chunk/s]Loading shards:  84%|████████▍ | 116/138 [03:46<00:17,  1.24chunk/s]Loading shards:  85%|████████▍ | 117/138 [03:47<00:17,  1.21chunk/s]Loading shards:  86%|████████▌ | 118/138 [03:48<00:18,  1.11chunk/s]Loading shards:  86%|████████▌ | 119/138 [03:49<00:16,  1.16chunk/s]Loading shards:  87%|████████▋ | 120/138 [03:50<00:16,  1.11chunk/s]Loading shards:  88%|████████▊ | 121/138 [03:51<00:16,  1.03chunk/s]Loading shards:  88%|████████▊ | 122/138 [03:52<00:14,  1.10chunk/s]Loading shards:  89%|████████▉ | 123/138 [03:52<00:12,  1.22chunk/s]Loading shards:  90%|████████▉ | 124/138 [03:53<00:10,  1.30chunk/s]Loading shards:  91%|█████████ | 125/138 [03:54<00:09,  1.37chunk/s]Loading shards:  91%|█████████▏| 126/138 [03:54<00:09,  1.26chunk/s]Loading shards:  92%|█████████▏| 127/138 [03:55<00:08,  1.27chunk/s]Loading shards:  93%|█████████▎| 128/138 [03:56<00:07,  1.36chunk/s]Loading shards:  93%|█████████▎| 129/138 [03:57<00:06,  1.36chunk/s]Loading shards:  94%|█████████▍| 130/138 [04:01<00:14,  1.79s/chunk]Loading shards:  95%|█████████▍| 131/138 [04:06<00:20,  2.90s/chunk]Loading shards:  96%|█████████▌| 132/138 [04:14<00:25,  4.18s/chunk]Loading shards:  96%|█████████▋| 133/138 [04:15<00:17,  3.46s/chunk]Loading shards:  97%|█████████▋| 134/138 [04:17<00:11,  2.85s/chunk]Loading shards:  98%|█████████▊| 135/138 [04:18<00:06,  2.24s/chunk]Loading shards:  99%|█████████▊| 136/138 [04:18<00:03,  1.82s/chunk]Loading shards:  99%|█████████▉| 137/138 [04:19<00:01,  1.57s/chunk]Loading shards: 100%|██████████| 138/138 [04:20<00:00,  1.31s/chunk]Loading shards: 100%|██████████| 138/138 [04:20<00:00,  1.89s/chunk]
[After loading data] CPU: 4.72GB | GPU: 0.00GB used / 0.00GB total
[norm] L2-normalizing embeddings
[Before L2 norm] CPU: 4.70GB | GPU: 0.00GB used / 0.00GB total
[norm] Using GPU for L2 normalization
GPU normalization failed: cudaErrorInvalidValue: invalid argument, falling back to CPU
[norm] Using CPU for L2 normalization
L2 norm (CPU):   0%|          | 0/7 [00:00<?, ?block/s]L2 norm (CPU):  14%|█▍        | 1/7 [00:02<00:13,  2.23s/block]L2 norm (CPU):  29%|██▊       | 2/7 [00:04<00:11,  2.35s/block]L2 norm (CPU):  43%|████▎     | 3/7 [00:06<00:09,  2.33s/block]L2 norm (CPU):  57%|█████▋    | 4/7 [00:09<00:06,  2.22s/block]L2 norm (CPU):  71%|███████▏  | 5/7 [00:11<00:04,  2.23s/block]L2 norm (CPU):  86%|████████▌ | 6/7 [00:13<00:02,  2.21s/block]L2 norm (CPU): 100%|██████████| 7/7 [00:15<00:00,  2.09s/block]L2 norm (CPU): 100%|██████████| 7/7 [00:15<00:00,  2.18s/block]
/var/spool/slurm/d/job201095/slurm_script: line 26: 383318 Killed                  python cluster_chunks.py --chunks_root /vol/bitbucket/bp824/astro/level_clustering/specter_adaptation/embeddings_v1_astrobert --work_dir ./cluster_out_v2_astrobert --backend umap_hdbscan --umap_dim 60 --n_neighbors 240 --min_cluster_size 12 --min_samples 2 --debug_memory
slurmstepd: error: Detected 1 oom_kill event in StepId=201095.batch. Some of the step tasks have been OOM Killed.
